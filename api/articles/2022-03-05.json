{"title":"基于Bevy的扫雷游戏(1)","uid":"649086876175b6262b284227d70ea0a8","slug":"2022-03-05","date":"2022-03-05T06:01:03.000Z","updated":"2024-03-06T02:36:48.103Z","comments":true,"path":"api/articles/2022-03-05.json","keywords":"Programming, Web, Frontend, Backend ,Rust, Blog, Aurora, Fontlos, 芳塔洛斯","cover":"https://fontlos.com/cover/bevy.svg","content":"<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">注意</p>\n<p>文章重写中</p>\n</div>\n<h1 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h1><p><a href=\"https://bevyengine.org/\">Bevy</a> 是一个免费开源的游戏引擎, 用 Rust 编写, 采用 ECS 范式, 接下来让我们基于 Bevy 实现一个扫雷游戏</p>\n<h1 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h1><p>首先新建一个 Crate</p>\n<div class=\"language-sh\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sh</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #61AFEF\">cargo</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">new</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">minesweeper</span></span></code></pre></div><p>我习惯将 Lib Crate 与 Bin Crate 放在同一个 Project 里, 所以我们在 <code>src</code> 下新建一个 <code>lib.rs</code> 文件, 现在的文件目录大概是这样:</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #abb2bf\">├── src</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">│   ├── main.rs</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">│ \t└── lib.rs</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">├── Cargo.toml</span></span></code></pre></div><p>接下来添加一下需要用到的 Crate<br>将以下内容添加到 <code>Cargo.toml</code> 中</p>\n<div class=\"language-toml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">toml</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #ABB2BF\">[</span><span style=\"color: #61AFEF\">features</span><span style=\"color: #ABB2BF\">]</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">default</span><span style=\"color: #ABB2BF\"> = []</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\"># 用于调试的feature</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">debug</span><span style=\"color: #ABB2BF\"> = [</span><span style=\"color: #98C379\">&quot;colored&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #98C379\">&quot;bevy-inspector-egui&quot;</span><span style=\"color: #ABB2BF\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">[</span><span style=\"color: #61AFEF\">dependencies</span><span style=\"color: #ABB2BF\">]</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\"># bevy引擎本体</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">bevy</span><span style=\"color: #ABB2BF\"> = </span><span style=\"color: #98C379\">&quot;0.6.1&quot;</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\"># 用于序列化数据</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">serde</span><span style=\"color: #ABB2BF\"> = </span><span style=\"color: #98C379\">&quot;1.0&quot;</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\"># 生成随机数</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">rand</span><span style=\"color: #ABB2BF\"> = </span><span style=\"color: #98C379\">&quot;0.8&quot;</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\"># 控制台调试, 可彩色输出</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">colored</span><span style=\"color: #ABB2BF\"> = { </span><span style=\"color: #E06C75\">version</span><span style=\"color: #ABB2BF\"> = </span><span style=\"color: #98C379\">&quot;2.0&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">optional</span><span style=\"color: #ABB2BF\"> = </span><span style=\"color: #D19A66\">true</span><span style=\"color: #ABB2BF\"> }</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\"># 这是bevy社区的一个用于在游戏内调试数据的插件</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">bevy-inspector-egui</span><span style=\"color: #ABB2BF\"> = { </span><span style=\"color: #E06C75\">version</span><span style=\"color: #ABB2BF\"> = </span><span style=\"color: #98C379\">&quot;0.8&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">optional</span><span style=\"color: #ABB2BF\"> = </span><span style=\"color: #D19A66\">true</span><span style=\"color: #ABB2BF\"> }</span></span></code></pre></div><h2 id=\"编写基本结构\"><a href=\"#编写基本结构\" class=\"headerlink\" title=\"编写基本结构\"></a>编写基本结构</h2><p>首先我们在 <code>lib.rs</code> 里创建一个 Bevy 的 <code>Plugin</code>, 也就是一个结构体</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// src/lib.rs</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">/// 游戏面板插件</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">struct</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">BoardPlugin</span><span style=\"color: #ABB2BF\">;</span></span></code></pre></div><p>接着我们在 <code>main.rs</code> 中添加如下内容</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// src/main.rs</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">bevy</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">prelude</span><span style=\"color: #ABB2BF\">::*;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">main</span><span style=\"color: #ABB2BF\">() {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">app</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">App</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #61AFEF\">new</span><span style=\"color: #ABB2BF\">();</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 窗口基本设定</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E06C75\">app</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">insert_resource</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E5C07B\">WindowDescriptor</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E06C75\">title</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #98C379\">&quot;Mine Sweeper&quot;</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">to_string</span><span style=\"color: #ABB2BF\">(),</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E06C75\">width</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #D19A66\">700</span><span style=\"color: #ABB2BF\">.,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E06C75\">height</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #D19A66\">800</span><span style=\"color: #ABB2BF\">.,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        ..</span><span style=\"color: #E5C07B\">Default</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #61AFEF\">default</span><span style=\"color: #ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    })</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 添加bevy的默认插件</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    .</span><span style=\"color: #61AFEF\">add_plugins</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E5C07B\">DefaultPlugins</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    #[cfg(feature </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;debug&quot;</span><span style=\"color: #ABB2BF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 仅在debug feature下添加调试器</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E06C75\">app</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">add_plugin</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E5C07B\">WorldInspectorPlugin</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #61AFEF\">new</span><span style=\"color: #ABB2BF\">());</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 添加启动system, 用于初始化相机</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E06C75\">app</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">add_startup_system</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">camera_setup</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // Run</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E06C75\">app</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">run</span><span style=\"color: #ABB2BF\">();</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">camera_setup</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">commands</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">Commands</span><span style=\"color: #ABB2BF\">) {</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 新建一个 2D 正交相机</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E06C75\">commands</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">spawn_bundle</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E5C07B\">OrthographicCameraBundle</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #61AFEF\">new_2d</span><span style=\"color: #ABB2BF\">());</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span></code></pre></div><ul>\n<li>执行 <code>cargo run</code> 将会得到一个空窗口</li>\n<li>执行 <code>cargo run --feature debug</code> 会多一个游戏数据调试框, 类似于下面这样</li>\n</ul>\n<p><img src=\"https://fangtaluosi.top/img/blog/2022-03-05/1.png\" alt=\"图片缺失\"></p>\n<p>至此, 一个基本框架算是搭建完成了</p>\n<h1 id=\"制作雷区网格\"><a href=\"#制作雷区网格\" class=\"headerlink\" title=\"制作雷区网格\"></a>制作雷区网格</h1><p>在 <code>lib.rs</code> 内添加如下内容</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C678DD\">mod</span><span style=\"color: #ABB2BF\"> components;</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">mod</span><span style=\"color: #ABB2BF\"> resources;</span></span></code></pre></div><h2 id=\"坐标组件\"><a href=\"#坐标组件\" class=\"headerlink\" title=\"坐标组件\"></a>坐标组件</h2><p>新建以下文件</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// src/components/mod.rs</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">mod</span><span style=\"color: #ABB2BF\"> coordinates</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">coordinates</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\">;</span></span></code></pre></div><div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// src/components/coordinates.rs</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">std</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">fmt</span><span style=\"color: #ABB2BF\">::{</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Display</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Formatter</span><span style=\"color: #ABB2BF\">};</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">std</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">ops</span><span style=\"color: #ABB2BF\">::{</span><span style=\"color: #E5C07B\">Add</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Sub</span><span style=\"color: #ABB2BF\">};</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">bevy</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">prelude</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Component</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">#[cfg_attr(feature </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;debug&quot;</span><span style=\"color: #ABB2BF\">, derive(bevy_inspector_egui::</span><span style=\"color: #E5C07B\">Inspectable</span><span style=\"color: #ABB2BF\">))]</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">#[derive(</span><span style=\"color: #E5C07B\">Debug</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Default</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Copy</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Clone</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Ord</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">PartialOrd</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Eq</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">PartialEq</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Hash</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Component</span><span style=\"color: #ABB2BF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">struct</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// 定义坐标和运算, 以通过 + 直接使坐标相加</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">impl</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Add</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">for</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">type</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Output</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">add</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">rhs</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Output</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.x + </span><span style=\"color: #E06C75\">rhs</span><span style=\"color: #ABB2BF\">.x,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.y + </span><span style=\"color: #E06C75\">rhs</span><span style=\"color: #ABB2BF\">.y,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// 定义坐标差运算</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">impl</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Sub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">for</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">type</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Output</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">sub</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">rhs</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Output</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.x.</span><span style=\"color: #61AFEF\">saturating_sub</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">rhs</span><span style=\"color: #ABB2BF\">.x),</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.y.</span><span style=\"color: #61AFEF\">saturating_sub</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">rhs</span><span style=\"color: #ABB2BF\">.y),</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// 用于调试输出</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">impl</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Display</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">for</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">fmt</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">f</span><span style=\"color: #ABB2BF\">: &amp;</span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Formatter</span><span style=\"color: #ABB2BF\">&lt;&#39;</span><span style=\"color: #E5C07B\">_</span><span style=\"color: #ABB2BF\">&gt;) -&gt; </span><span style=\"color: #E5C07B\">fmt</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Result</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #61AFEF\">write!</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">f</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #98C379\">&quot;({}, {})&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.x, </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.y)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span></code></pre></div><h2 id=\"地砖\"><a href=\"#地砖\" class=\"headerlink\" title=\"地砖\"></a>地砖</h2><p>接下来为游戏添加一些资源, 新建以下文件, 制作游戏中的地砖</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// src/resources/mod.rs</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">crate</span><span style=\"color: #ABB2BF\">) </span><span style=\"color: #C678DD\">mod</span><span style=\"color: #ABB2BF\"> tile;</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">crate</span><span style=\"color: #ABB2BF\">) </span><span style=\"color: #C678DD\">mod</span><span style=\"color: #ABB2BF\"> tile_map;</span></span></code></pre></div><div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// src/resources/tile.rs</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">#[cfg(feature </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;debug&quot;</span><span style=\"color: #ABB2BF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">colored</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Colorize</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">/// 游戏中的地砖枚举</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">#[derive(</span><span style=\"color: #E5C07B\">Debug</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Copy</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Clone</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Eq</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">PartialEq</span><span style=\"color: #ABB2BF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">enum</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    /// 地雷</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E5C07B\">Bomb</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    /// 周围地雷数</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #61AFEF\">BombNeighbor</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E5C07B\">u8</span><span style=\"color: #ABB2BF\">),</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    /// 空地砖</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E5C07B\">Empty</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">impl</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    /// 判断是否为地雷</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">is_bomb</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #E5C07B\">bool</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #61AFEF\">matches!</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Bomb</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 在命令行调试中输出字符串形式的地图, 并附带有颜色</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    #[cfg(feature </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;debug&quot;</span><span style=\"color: #ABB2BF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">console_output</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #E5C07B\">String</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #61AFEF\">format!</span><span style=\"color: #ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #98C379\">&quot;{}&quot;</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #C678DD\">match</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Bomb</span><span style=\"color: #ABB2BF\"> =&gt; </span><span style=\"color: #98C379\">&quot;*&quot;</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">bright_red</span><span style=\"color: #ABB2BF\">(),</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #61AFEF\">BombNeighbor</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">v</span><span style=\"color: #ABB2BF\">) =&gt; </span><span style=\"color: #C678DD\">match</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">v</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                    </span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\"> =&gt; </span><span style=\"color: #98C379\">&quot;1&quot;</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">cyan</span><span style=\"color: #ABB2BF\">(),</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                    </span><span style=\"color: #D19A66\">2</span><span style=\"color: #ABB2BF\"> =&gt; </span><span style=\"color: #98C379\">&quot;2&quot;</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">green</span><span style=\"color: #ABB2BF\">(),</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                    </span><span style=\"color: #D19A66\">3</span><span style=\"color: #ABB2BF\"> =&gt; </span><span style=\"color: #98C379\">&quot;3&quot;</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">yellow</span><span style=\"color: #ABB2BF\">(),</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                    </span><span style=\"color: #E06C75\">_</span><span style=\"color: #ABB2BF\"> =&gt; </span><span style=\"color: #E06C75\">v</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">to_string</span><span style=\"color: #ABB2BF\">().</span><span style=\"color: #61AFEF\">red</span><span style=\"color: #ABB2BF\">(),</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                },</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Empty</span><span style=\"color: #ABB2BF\"> =&gt; </span><span style=\"color: #98C379\">&quot; &quot;</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">normal</span><span style=\"color: #ABB2BF\">(),</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        )</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span></code></pre></div><h2 id=\"生成雷区地图\"><a href=\"#生成雷区地图\" class=\"headerlink\" title=\"生成雷区地图\"></a>生成雷区地图</h2><p>新建如下文件</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">//  src/resources/tile_map.rs</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">crate</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">resources</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">tile</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">std</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">ops</span><span style=\"color: #ABB2BF\">::{</span><span style=\"color: #E5C07B\">Deref</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">DerefMut</span><span style=\"color: #ABB2BF\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">/// 基本地图</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">#[derive(</span><span style=\"color: #E5C07B\">Debug</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">Clone</span><span style=\"color: #ABB2BF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">struct</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">TileMap</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E06C75\">bomb_count</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E06C75\">height</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E06C75\">width</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E06C75\">map</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">Vec</span><span style=\"color: #ABB2BF\">&lt;</span><span style=\"color: #E5C07B\">Vec</span><span style=\"color: #ABB2BF\">&lt;</span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\">&gt;&gt;,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">impl</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">TileMap</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    /// 生成空地图</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">empty</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">width</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">height</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">map</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> (</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">..</span><span style=\"color: #E06C75\">height</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            .</span><span style=\"color: #61AFEF\">into_iter</span><span style=\"color: #ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            .</span><span style=\"color: #61AFEF\">map</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #56B6C2\">|</span><span style=\"color: #E06C75\">_</span><span style=\"color: #56B6C2\">|</span><span style=\"color: #ABB2BF\"> (</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">..</span><span style=\"color: #E06C75\">width</span><span style=\"color: #ABB2BF\">).</span><span style=\"color: #61AFEF\">into_iter</span><span style=\"color: #ABB2BF\">().</span><span style=\"color: #61AFEF\">map</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #56B6C2\">|</span><span style=\"color: #E06C75\">_</span><span style=\"color: #56B6C2\">|</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Empty</span><span style=\"color: #ABB2BF\">).</span><span style=\"color: #61AFEF\">collect</span><span style=\"color: #ABB2BF\">())</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            .</span><span style=\"color: #61AFEF\">collect</span><span style=\"color: #ABB2BF\">();</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #E06C75\">bomb_count</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #E06C75\">height</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #E06C75\">width</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #E06C75\">map</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    #[cfg(feature </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;debug&quot;</span><span style=\"color: #ABB2BF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">console_output</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #E5C07B\">String</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">buffer</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">format!</span><span style=\"color: #ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #98C379\">&quot;Map ({}, {}) with {} bombs:</span><span style=\"color: #56B6C2\">\\n</span><span style=\"color: #98C379\">&quot;</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.width, </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.height, </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.bomb_count</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        );</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">line</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">String</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> (</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">..=(</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.width + </span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">)).</span><span style=\"color: #61AFEF\">into_iter</span><span style=\"color: #ABB2BF\">().</span><span style=\"color: #61AFEF\">map</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #56B6C2\">|</span><span style=\"color: #E06C75\">_</span><span style=\"color: #56B6C2\">|</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&#39;-&#39;</span><span style=\"color: #ABB2BF\">).</span><span style=\"color: #61AFEF\">collect</span><span style=\"color: #ABB2BF\">();</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E06C75\">buffer</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">format!</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;{}{}</span><span style=\"color: #56B6C2\">\\n</span><span style=\"color: #98C379\">&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">buffer</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">line</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">for</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">line</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">in</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">iter</span><span style=\"color: #ABB2BF\">().</span><span style=\"color: #61AFEF\">rev</span><span style=\"color: #ABB2BF\">() {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #E06C75\">buffer</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">format!</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;{}|&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">buffer</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #C678DD\">for</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">tile</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">in</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">line</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">iter</span><span style=\"color: #ABB2BF\">() {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #E06C75\">buffer</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">format!</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;{}{}&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">buffer</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">tile</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">console_output</span><span style=\"color: #ABB2BF\">());</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #E06C75\">buffer</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">format!</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;{}|</span><span style=\"color: #56B6C2\">\\n</span><span style=\"color: #98C379\">&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">buffer</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #61AFEF\">format!</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;{}{}&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">buffer</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">line</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 获得宽度</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">width</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.width</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 获得高度</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">height</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.height</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 获得周围地雷数</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">bomb_count</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.bomb_count</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">impl</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Deref</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">for</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">TileMap</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">type</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Target</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Vec</span><span style=\"color: #ABB2BF\">&lt;</span><span style=\"color: #E5C07B\">Vec</span><span style=\"color: #ABB2BF\">&lt;</span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\">&gt;&gt;;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">deref</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">) -&gt; &amp;</span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Target</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        &amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.map</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">impl</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">DerefMut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">for</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">TileMap</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">deref_mut</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">) -&gt; &amp;</span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Target</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        &amp;</span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.map</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">/// 每个格子周围八个坐标</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66\">SQUARE_COORDINATES</span><span style=\"color: #ABB2BF\">: [(</span><span style=\"color: #E5C07B\">i8</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">i8</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #D19A66\">8</span><span style=\"color: #ABB2BF\">] </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> [</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 左下</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    (-</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">, -</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">),</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 正下</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    (</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, -</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">),</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 右下</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    (</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">, -</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">),</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 正左</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    (-</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">),</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 正右</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    (</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">),</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 左上</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    (-</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">),</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 正上</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    (</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">),</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    // 右上</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    (</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">),</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">];</span></span></code></pre></div><p>为了检索每个格子周围的八个格子, 添加以下方法</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">//  src/resources/tile_map.rs</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">crate</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">components</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// ..</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">safe_square_at</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">coordinates</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #C678DD\">impl</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Iterator</span><span style=\"color: #ABB2BF\">&lt;</span><span style=\"color: #E5C07B\">Item</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\">&gt; {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #D19A66\">SQUARE_COORDINATES</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            .</span><span style=\"color: #61AFEF\">iter</span><span style=\"color: #ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            .</span><span style=\"color: #61AFEF\">copied</span><span style=\"color: #ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            .</span><span style=\"color: #61AFEF\">map</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">move</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">|</span><span style=\"color: #E06C75\">tuple</span><span style=\"color: #56B6C2\">|</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">coordinates</span><span style=\"color: #ABB2BF\"> + </span><span style=\"color: #E06C75\">tuple</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span></code></pre></div><p>为了能让坐标与u8元组相加, 我们需要再添加一个坐标相加方法</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// src/components/coordinates.rs</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">impl</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Add</span><span style=\"color: #ABB2BF\">&lt;(</span><span style=\"color: #E5C07B\">i8</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">i8</span><span style=\"color: #ABB2BF\">)&gt; </span><span style=\"color: #C678DD\">for</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">type</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Output</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">add</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">, (</span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\">): (</span><span style=\"color: #E5C07B\">i8</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">i8</span><span style=\"color: #ABB2BF\">)) -&gt; </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Output</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> ((</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.x </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">i16</span><span style=\"color: #ABB2BF\">) + </span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">i16</span><span style=\"color: #ABB2BF\">) </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> ((</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.y </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">i16</span><span style=\"color: #ABB2BF\">) + </span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">i16</span><span style=\"color: #ABB2BF\">) </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\"> }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span></code></pre></div><p>现在我们可以检索周围的地砖, 并计算坐标周围的地雷数来填充格子了</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// src/resources/tile_map.rs</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// ..</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">is_bomb_at</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">coordinates</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #E5C07B\">bool</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">if</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">coordinates</span><span style=\"color: #ABB2BF\">.x </span><span style=\"color: #56B6C2\">&gt;=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.width </span><span style=\"color: #56B6C2\">||</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">coordinates</span><span style=\"color: #ABB2BF\">.y </span><span style=\"color: #56B6C2\">&gt;=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.height {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #C678DD\">return</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66\">false</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        };</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.map[</span><span style=\"color: #E06C75\">coordinates</span><span style=\"color: #ABB2BF\">.y </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">usize</span><span style=\"color: #ABB2BF\">][</span><span style=\"color: #E06C75\">coordinates</span><span style=\"color: #ABB2BF\">.x </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">usize</span><span style=\"color: #ABB2BF\">].</span><span style=\"color: #61AFEF\">is_bomb</span><span style=\"color: #ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">bomb_count_at</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">coordinates</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\">) -&gt; </span><span style=\"color: #E5C07B\">u8</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">if</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">is_bomb_at</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">coordinates</span><span style=\"color: #ABB2BF\">) {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #C678DD\">return</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">res</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            .</span><span style=\"color: #61AFEF\">safe_square_at</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">coordinates</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            .</span><span style=\"color: #61AFEF\">filter</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #56B6C2\">|</span><span style=\"color: #E06C75\">coord</span><span style=\"color: #56B6C2\">|</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">is_bomb_at</span><span style=\"color: #ABB2BF\">(*</span><span style=\"color: #E06C75\">coord</span><span style=\"color: #ABB2BF\">))</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            .</span><span style=\"color: #61AFEF\">count</span><span style=\"color: #ABB2BF\">();</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E06C75\">res</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">u8</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span></code></pre></div><p>下面通过随机数来生成地图, 放置地雷</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// src/resources/tile_map.rs</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">rand</span><span style=\"color: #ABB2BF\">::{thread_rng, </span><span style=\"color: #E5C07B\">Rng</span><span style=\"color: #ABB2BF\">};</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// ..</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    /// 放置地雷及普通格子</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">set_bombs</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">bomb_count</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">u16</span><span style=\"color: #ABB2BF\">) {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.bomb_count </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">bomb_count</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">remaining_bombs</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">bomb_count</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">rng</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">thread_rng</span><span style=\"color: #ABB2BF\">();</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">        // 生成地雷</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">while</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">remaining_bombs</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">&gt;</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> (</span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\">) </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> (</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #E06C75\">rng</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">gen_range</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">..</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.width) </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">usize</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #E06C75\">rng</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">gen_range</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">..</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.height) </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">usize</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            );</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #C678DD\">if</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Empty</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">[</span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\">][</span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\">] {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">[</span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\">][</span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\">] </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">Bomb</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #E06C75\">remaining_bombs</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">-=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        }</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">        // 生成普通地砖</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">for</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">in</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">..</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.height {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            </span><span style=\"color: #C678DD\">for</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">in</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">..</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.width {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">coords</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Coordinates</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\"> };</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #C678DD\">if</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">is_bomb_at</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">coords</span><span style=\"color: #ABB2BF\">) {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                    </span><span style=\"color: #C678DD\">continue</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">num</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">bomb_count_at</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">coords</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #C678DD\">if</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">num</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">==</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                    </span><span style=\"color: #C678DD\">continue</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">tile</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> &amp;</span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">[</span><span style=\"color: #E06C75\">y</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">usize</span><span style=\"color: #ABB2BF\">][</span><span style=\"color: #E06C75\">x</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">usize</span><span style=\"color: #ABB2BF\">];</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">                *</span><span style=\"color: #E06C75\">tile</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Tile</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #61AFEF\">BombNeighbor</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">num</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">            }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span></code></pre></div><h2 id=\"测试插件\"><a href=\"#测试插件\" class=\"headerlink\" title=\"测试插件\"></a>测试插件</h2><p>下面把我们目前所做的封装成插件</p>\n<p>在 <code>lib.rs</code> 中加入如下内容</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// src/lib.rs</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">mod</span><span style=\"color: #ABB2BF\"> components;</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">mod</span><span style=\"color: #ABB2BF\"> resources;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">bevy</span><span style=\"color: #ABB2BF\">::log;</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">bevy</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">prelude</span><span style=\"color: #ABB2BF\">::*;</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">resources</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">tile_map</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">TileMap</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">/// 游戏面板插件</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">struct</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">BoardPlugin</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">impl</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">Plugin</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">for</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">BoardPlugin</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">build</span><span style=\"color: #ABB2BF\">(&amp;</span><span style=\"color: #E5C07B\">self</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">app</span><span style=\"color: #ABB2BF\">: &amp;</span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">App</span><span style=\"color: #ABB2BF\">) {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E06C75\">app</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">add_startup_system</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E5C07B\">Self</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E06C75\">create_board</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E5C07B\">log</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #61AFEF\">info!</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;Loaded Board Plugin&quot;</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">impl</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">BoardPlugin</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">    /// 生成面板</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">pub</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">fn</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">create_board</span><span style=\"color: #ABB2BF\">() {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">let</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">mut</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">tile_map</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">TileMap</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #61AFEF\">empty</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">20</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">20</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E06C75\">tile_map</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">set_bombs</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">40</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        #[cfg(feature </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;debug&quot;</span><span style=\"color: #ABB2BF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #E5C07B\">log</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #61AFEF\">info!</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;{}&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">tile_map</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">console_output</span><span style=\"color: #ABB2BF\">());</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span></code></pre></div><p>接下来在 <code>main.rs</code> 文件中调用插件进行测试吧</p>\n<div class=\"language-rust\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">rust</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// src/main.rs</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">use</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">minesweeper</span><span style=\"color: #ABB2BF\">::</span><span style=\"color: #E5C07B\">BoardPlugin</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// ..</span></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// 添加雷区地图</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">app</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">add_plugin</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E5C07B\">BoardPlugin</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"></span></code></pre></div><p>执行 <code>cargo run --features debug</code>, 会有类似于以下输出</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #abb2bf\">2022-03-05T10:45:33.299087Z  INFO bevy_render::renderer: AdapterInfo { name: &quot;NVIDIA GeForce GTX 1660 Ti with Max-Q Design&quot;, vendor: 4318, device: 8593, device_type: DiscreteGpu, backend: Vulkan }</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">2022-03-05T10:45:33.777658Z  INFO minesweeper: Loaded Board Plugin</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">2022-03-05T10:45:33.808146Z  INFO minesweeper: Map (20, 20) with 40 bombs:</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">----------------------</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|  12211111221     11|</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|  1**11*12**1     1*|</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|  12322112*31111 122|</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|    1*1  111 1*1 1*1|</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|11  111      1111221|</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|*1      11211   1*1 |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|2311  112*3*1   111 |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|*2*21 1*33*21       |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|233*1123*321 111111 |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|1*2111*22*21 1*11*1 |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|1111121112*1 2221232|</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|   1*2111221 1*1 1**|</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|   123*11*1  111 122|</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|   12*21111         |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">| 112*211221         |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">| 1*211 1**1         |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">| 111   1221         |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|           111      |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|     111   1*1 111  |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">|     1*1   111 1*1  |</span></span>\n<span class=\"line\"><span style=\"color: #abb2bf\">----------------------</span></span></code></pre></div>","feature":false,"text":" 注意 文章重写中 介绍Bevy 是一个免费开源的游戏引擎, 用 Rust 编写, 采用 ECS 范式, 接下来让我们基于 Bevy 实现一个扫雷游戏 准备首先...","permalink":"/post/2022-03-05","photos":[],"count_time":{"symbolsCount":"10k","symbolsTime":"9 mins."},"categories":[{"name":"Course","slug":"Course","count":11,"path":"api/categories/Course.json"}],"tags":[{"name":"Bevy","slug":"Bevy","count":2,"path":"api/tags/Bevy.json"},{"name":"Rust","slug":"Rust","count":12,"path":"api/tags/Rust.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">介绍</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%87%86%E5%A4%87\"><span class=\"toc-text\">准备</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%BC%96%E5%86%99%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">编写基本结构</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%88%B6%E4%BD%9C%E9%9B%B7%E5%8C%BA%E7%BD%91%E6%A0%BC\"><span class=\"toc-text\">制作雷区网格</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9D%90%E6%A0%87%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">坐标组件</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9C%B0%E7%A0%96\"><span class=\"toc-text\">地砖</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%94%9F%E6%88%90%E9%9B%B7%E5%8C%BA%E5%9C%B0%E5%9B%BE\"><span class=\"toc-text\">生成雷区地图</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B5%8B%E8%AF%95%E6%8F%92%E4%BB%B6\"><span class=\"toc-text\">测试插件</span></a></li></ol></li></ol>","author":{"name":"芳塔洛斯","slug":"blog-author","avatar":"https://fontlos.com/icons/avatar.jpg","link":"/","description":"来人间一趟, 为散步一场<br />待走出岁月, 何样的彼方<br />才配得上这一路的颠沛与时光","socials":{"github":"https://github.com/fontlos","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"https://fontlos.com/icons/bilibili.svg","link":"https://space.bilibili.com/362772872"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"基于Bevy的扫雷游戏(2)","uid":"29b1341e2b77e066dddc7ec9ddd945fe","slug":"2022-03-27","date":"2022-03-27T06:02:47.000Z","updated":"2024-03-06T02:36:48.103Z","comments":true,"path":"api/articles/2022-03-27.json","keywords":"Programming, Web, Frontend, Backend ,Rust, Blog, Aurora, Fontlos, 芳塔洛斯","cover":"https://fontlos.com/cover/bevy.svg","text":"基于Bevy的扫雷游戏, 地图绘制...","permalink":"/post/2022-03-27","photos":[],"count_time":{"symbolsCount":"18k","symbolsTime":"17 mins."},"categories":[{"name":"Course","slug":"Course","count":11,"path":"api/categories/Course.json"}],"tags":[{"name":"Bevy","slug":"Bevy","count":2,"path":"api/tags/Bevy.json"},{"name":"Rust","slug":"Rust","count":12,"path":"api/tags/Rust.json"}],"author":{"name":"芳塔洛斯","slug":"blog-author","avatar":"https://fontlos.com/icons/avatar.jpg","link":"/","description":"来人间一趟, 为散步一场<br />待走出岁月, 何样的彼方<br />才配得上这一路的颠沛与时光","socials":{"github":"https://github.com/fontlos","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"https://fontlos.com/icons/bilibili.svg","link":"https://space.bilibili.com/362772872"}}}},"feature":false},"next_post":{"title":"Zola使用教程(3) Templates","uid":"1bce5ded41dcb5c5e4afc4fd8cbdf1b2","slug":"2022-01-26","date":"2022-01-26T13:56:37.000Z","updated":"2024-03-06T02:36:48.103Z","comments":true,"path":"api/articles/2022-01-26.json","keywords":"Programming, Web, Frontend, Backend ,Rust, Blog, Aurora, Fontlos, 芳塔洛斯","cover":"https://fontlos.com/icons/logo.png","text":"Zola的分类分页...","permalink":"/post/2022-01-26","photos":[],"count_time":{"symbolsCount":308,"symbolsTime":"1 mins."},"categories":[{"name":"Note","slug":"Note","count":9,"path":"api/categories/Note.json"}],"tags":[{"name":"Zola","slug":"Zola","count":3,"path":"api/tags/Zola.json"},{"name":"Frontend","slug":"Frontend","count":5,"path":"api/tags/Frontend.json"}],"author":{"name":"芳塔洛斯","slug":"blog-author","avatar":"https://fontlos.com/icons/avatar.jpg","link":"/","description":"来人间一趟, 为散步一场<br />待走出岁月, 何样的彼方<br />才配得上这一路的颠沛与时光","socials":{"github":"https://github.com/fontlos","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"https://fontlos.com/icons/bilibili.svg","link":"https://space.bilibili.com/362772872"}}}},"feature":false}}